<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="/logo.svg" />
    <link rel="apple-touch-icon" href="/logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Browser compatibility polyfills - loaded before main app -->
    <script>
      // Global polyfill for older browsers
      if (typeof globalThis === 'undefined') {
        window.globalThis = window;
      }
      
      // Ensure console exists (very old browsers)
      if (typeof console === 'undefined') {
        window.console = {
          log: function() {},
          warn: function() {},
          error: function() {},
          info: function() {},
        };
      }
      
      // Ensure requestAnimationFrame exists (older browsers)
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function(callback) {
          return setTimeout(callback, 16);
        };
        window.cancelAnimationFrame = function(id) {
          clearTimeout(id);
        };
      }
      
      // Ensure performance.now exists (older browsers)
      if (!window.performance || !window.performance.now) {
        if (window.performance) {
          window.performance.now = function() {
            return Date.now();
          };
        } else {
          window.performance = { now: function() { return Date.now(); } };
        }
      }
    </script>
    <!-- Theme initialization - prevents flash of wrong theme -->
    <script>
      (function() {
        try {
          const theme = localStorage.getItem('theme') || 'dark';
          const html = document.documentElement;
          
          // Remove any existing theme classes
          html.classList.remove('dark', 'light');
          
          // Apply theme
          if (theme === 'dark') {
            html.classList.add('dark');
            html.setAttribute('data-theme', 'dark');
            html.style.colorScheme = 'dark';
          } else {
            html.classList.remove('dark');
            html.setAttribute('data-theme', 'light');
            html.style.colorScheme = 'light';
          }
        } catch (e) {
          // Fallback to dark if localStorage fails
          const html = document.documentElement;
          html.classList.add('dark');
          html.setAttribute('data-theme', 'dark');
          html.style.colorScheme = 'dark';
        }
      })();
    </script>
    <meta
      http-equiv="Content-Security-Policy"
      content="frame-src 'self' https://*.paddle.com https://buy.paddle.com https://sandbox-checkout.paddle.com https://checkout.paddle.com https://www.youtube.com https://youtube.com https://*.youtube.com https://vercel.live; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.paddle.com https://core.spreedly.com https://global.localizecdn.com https://js.stripe.com https://va.vercel-scripts.com https://public.profitwell.com https://buy.paddle.com https://vercel.live; script-src-elem 'self' 'unsafe-inline' https://cdn.paddle.com https://core.spreedly.com https://global.localizecdn.com https://js.stripe.com https://va.vercel-scripts.com https://public.profitwell.com https://buy.paddle.com https://vercel.live; connect-src 'self' https://*.paddle.com https://checkout-service.paddle.com https://sandbox-api.paddle.com https://api.paddle.com https://*.supabase.co https://va.vercel-scripts.com https://public.profitwell.com https://api.exchangerate-api.com https://api.exchangerate.host https://www.youtube.com https://youtube.com; img-src 'self' data: blob: https://*.supabase.co https://*.supabase.in https://i.ytimg.com https://*.ytimg.com;"
    />

    <!-- Primary Meta Tags -->
    <title>What's 4 Dinner? - Smart Recipe Finder & Meal Planning App</title>
    <meta name="title" content="What's 4 Dinner? - Smart Recipe Finder & Meal Planning App" />
    <meta
      name="description"
      content="Discover delicious recipes instantly! Search by ingredients, plan meals, create grocery lists, and manage your family's dietary needs. Free recipe finder with AI-powered meal planning, nutrition tracking, and smart ingredient matching."
    />
    <meta
      name="keywords"
      content="recipe finder, meal planning, dinner ideas, recipe search, meal planner, grocery list, cooking recipes, ingredient search, family meal planning, nutrition tracker, dietary restrictions, recipe app, food app, cooking app, meal prep, recipe discovery"
    />
    <meta name="author" content="What's 4 Dinner" />
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="language" content="English" />
    <meta name="revisit-after" content="7 days" />
    <meta name="rating" content="general" />
    <link rel="canonical" href="https://whats4dinner.app/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://whats4dinner.app/" />
    <meta
      property="og:title"
      content="What's 4 Dinner? - Smart Recipe Finder & Meal Planning App"
    />
    <meta
      property="og:description"
      content="Discover delicious recipes instantly! Search by ingredients, plan meals, create grocery lists, and manage your family's dietary needs. Free recipe finder with AI-powered meal planning."
    />
    <meta property="og:image" content="https://whats4dinner.app/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="What's 4 Dinner - Recipe Finder & Meal Planning App" />
    <meta property="og:site_name" content="What's 4 Dinner" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://whats4dinner.app/" />
    <meta
      name="twitter:title"
      content="What's 4 Dinner? - Smart Recipe Finder & Meal Planning App"
    />
    <meta
      name="twitter:description"
      content="Discover delicious recipes instantly! Search by ingredients, plan meals, create grocery lists, and manage your family's dietary needs."
    />
    <meta name="twitter:image" content="https://whats4dinner.app/og-image.png" />
    <meta name="twitter:image:alt" content="What's 4 Dinner - Recipe Finder & Meal Planning App" />

    <!-- Structured Data (JSON-LD) for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "What's 4 Dinner",
        "alternateName": "W4D",
        "url": "https://whats4dinner.app",
        "logo": "https://whats4dinner.app/logo.svg",
        "description": "Smart recipe finder and meal planning app. Search recipes by ingredients, plan your meals, create grocery lists, and manage your family's dietary needs.",
        "applicationCategory": "Food & Drink",
        "operatingSystem": "Web, iOS, Android",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "1000"
        },
        "featureList": [
          "Recipe search by ingredients",
          "AI-powered meal planning",
          "Smart grocery list generation",
          "Family meal management",
          "Nutrition tracking",
          "Dietary restriction filtering",
          "Recipe favorites and collections",
          "Meal prep planning",
          "Calorie tracking",
          "Water intake tracking"
        ]
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "What's 4 Dinner",
        "url": "https://whats4dinner.app",
        "logo": "https://whats4dinner.app/logo.svg",
        "sameAs": []
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "What's 4 Dinner",
        "url": "https://whats4dinner.app",
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://whats4dinner.app/?search={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      }
    </script>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#10b981" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="What's 4 Dinner" />
    <link rel="apple-touch-icon" href="/logo.svg" />

    <!-- Paddle.js for checkout handling -->
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
  </head>
  <body class="bg-amber-50/30 dark:bg-slate-950">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <!-- Service Worker is handled by VitePWA plugin - it will auto-register in production -->
    <script>
      // Suppress console warnings/errors for known non-critical issues
      const originalWarn = console.warn;
      const originalError = console.error;

      console.warn = function (...args) {
        const message = args.join(' ');
        // Suppress CSP warnings for Vercel Live (harmless)
        if (
          message.includes('Content-Security-Policy') &&
          (message.includes('vercel.live') || message.includes('vercel-scripts'))
        ) {
          return;
        }
        // Suppress CSP warnings about unsafe-eval in script-src-elem (we moved it to script-src)
        if (
          message.includes('Content-Security-Policy') &&
          (message.includes("Ignoring 'unsafe-eval'") || message.includes("Ignoring 'wasm-unsafe-eval'"))
        ) {
          return;
        }
        // Suppress cookie warnings (Cloudflare issue, harmless)
        if (
          message.includes('Cookie') &&
          (message.includes('__cf_bm') || message.includes('will soon be rejected') || message.includes('Partitioned'))
        ) {
          return;
        }
        // Suppress Chrome version warnings (UA sniffing, harmless)
        if (message.includes('older version of chrome') || message.includes('Some features may not work correctly')) {
          return;
        }
        // Suppress OpaqueResponseBlocking warnings (we handle this by excluding Supabase images from SW)
        if (message.includes('OpaqueResponseBlocking')) {
          return;
        }
        // Suppress service worker registration messages in production
        if (
          !window.location.hostname.includes('localhost') &&
          !window.location.hostname.includes('127.0.0.1') &&
          message.includes('SW registered')
        ) {
          return;
        }
        originalWarn.apply(console, args);
      };

      console.error = function (...args) {
        const message = args.join(' ');
        // Suppress CSP errors for Vercel Live (harmless)
        if (
          message.includes('Content-Security-Policy') &&
          (message.includes('vercel.live') || message.includes('vercel-scripts'))
        ) {
          return;
        }
        // Suppress cookie errors (Cloudflare issue, harmless)
        if (
          message.includes('Cookie') &&
          (message.includes('__cf_bm') || message.includes('rejected for invalid domain'))
        ) {
          return;
        }
        // Suppress image loading errors that are handled by fallback mechanism
        if (
          message.includes('Failed to load resource') &&
          (message.includes('hero.webp') || message.includes('recipe-images'))
        ) {
          return;
        }
        // Suppress NS_BINDING_ABORTED errors (network cancellation, harmless)
        if (message.includes('NS_BINDING_ABORTED')) {
          return;
        }
        originalError.apply(console, args);
      };

      // Cleanup: Unregister old manual service worker if it exists
      // Check if we're in dev mode (can't use import.meta in non-module script)
      const isDev =
        window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          registrations.forEach(registration => {
            // Unregister the old /sw.js service worker
            if (registration.scope.includes(window.location.origin)) {
              const scriptURL =
                registration.active?.scriptURL ||
                registration.installing?.scriptURL ||
                registration.waiting?.scriptURL ||
                '';
              if (scriptURL.includes('/sw.js')) {
                if (isDev) {
                  console.log('ðŸ”„ Unregistering old service worker:', registration.scope);
                }
                registration.unregister().then(() => {
                  if (isDev) {
                    console.log('âœ… Old service worker unregistered');
                  }
                  // Only reload in development to avoid disrupting production users
                  if (isDev) {
                    if (isDev) {
                      console.log('ðŸ”„ Reloading to activate new service worker...');
                    }
                    setTimeout(() => window.location.reload(), 1000);
                  }
                });
              }
            }
          });
        });
      }
    </script>
  </body>
</html>
